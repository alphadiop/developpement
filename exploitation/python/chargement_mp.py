###################################################################################################################
#            Chargement des donn√©es sur un serveur SQL - MultiProcessing                                          #
###################################################################################################################

import os
import sys

from path import Path

src_path = os.path.dirname(Path(os.path.abspath(__file__)).parent)
for rep in os.listdir(src_path):
    sys.path.append(os.path.join(src_path, rep))

from chargement_dw_mp import ChargementDwMp
from sql_connexion import get_sql_operations
from time_periodes import get_mois
from time_periodes import get_semaines


if __name__ == '__main__':
    moteur, periodicite = 'rfsotc', 'hebdo'
    parameters = dict(Moteur=moteur, Periodicite=periodicite)

    ptms = False
    if ptms:
        table = 'univers'
        periode_debut, periode_fin = '202001', '202005'
        sql_operations = get_sql_operations()
        periodes = (get_semaines(sql_operations, periode_debut, periode_fin) if periodicite == 'hebdo'
                    else get_mois(sql_operations, periode_debut, periode_fin))
        parameters.update({'Table': table, 'Periodes': periodes})
    else:
        periode = '202105'
        # tables = ['rfsotc']
        # tables = ['travelling_uga_uga', 'travelling_uga_departement', 'travelling_uga_france']
        # tables = ['repart_prescripteur_uga', 'repart_prescripteur_departement', 'repart_prescripteur_france']
        # tables = ['repart_pharmacie_uga', 'repart_pharmacie_departement', 'repart_pharmacie_france']
        tables = ['repart_prescripteur_hopital_uga', 'repart_prescripteur_hopital_departement', 'repart_prescripteur_hopital_france']
        # tables = ['repart_pharmacie_hopital_uga', 'repart_pharmacie_hopital_departement', 'repart_pharmacie_hopital_france']
        # tables = ['travelling_etablissement_presentation', 'travelling_etablissement_uga']
        # tables = ['travelling_uga_produit_uga', 'travelling_uga_produit_departement', 'travelling_uga_produit_france']
        # tables = ['repart_prescripteur_produit_uga', 'repart_prescripteur_produit_departement', 'repart_prescripteur_produit_france']
        # tables = ['repart_pharmacie_produit_uga', 'repart_pharmacie_produit_departement', 'repart_pharmacie_produit_france']
        # tables = ['repart_prescripteur_hopital_produit_uga', 'repart_prescripteur_hopital_produit_departement', 'repart_prescripteur_hopital_produit_france']
        # tables = ['repart_pharmacie_hopital_produit_uga', 'repart_pharmacie_hopital_produit_departement', 'repart_pharmacie_hopital_produit_france']
        # tables = ['travelling_etablissement_produit_presentation']
        parameters.update({'Periode': periode, 'Tables': tables})

    print('')
    print('Moteur     : ' + moteur)
    print('Periodicite: ' + periodicite)
    if 'Tables' in parameters.keys():
        print('Tables     : ' + str(parameters['Tables']))
    else:
        print('Table: ' + parameters['Table'])
    if 'Periodes' in parameters.keys():
        print('Periodes: ' + str(parameters['Periodes']))
    else:
        print('Periode    : ' + parameters['Periode'])
    print('')

    ChargementDwMp(parameters).run()
