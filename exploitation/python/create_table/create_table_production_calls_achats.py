# -*- coding: utf-8 -*-
"""
  Cr√©ation des tables de suivi de production des calls_achats
"""

import os

from load_json import load_json
from logger import LOGGER
from sql_connexion import get_sql_operations
from sql_schema import get_schema_from_json
from variable_environnement import get_variable_environnement
from variable_environnement import load_variable_environnement

if __name__ == '__main__':
    etude_parameters = dict(Moteur='tables_production_calls_achats', Periodicite='', Periode='')
    variable_environnement = load_variable_environnement()

    path_log = os.path.join(get_variable_environnement(variable_environnement, 'log'), 'table_productions_calls_achats',
                            '', '')
    logger = LOGGER(etude_parameters, path_log, type_logger="stream_file")

    path_production = os.path.join(get_variable_environnement(variable_environnement, 'pilotage'), 'gestion_production',
                                   'tables_calls_achats.json')
    table_productions = load_json(path_production, logger=logger)

    sql_operations = get_sql_operations(logger=logger)
    path_schema = get_variable_environnement(variable_environnement, 'schema')
    for table_name, table_dw in table_productions.items():
        logger.info(f"{table_name}: {table_dw}")
        schema = get_schema_from_json(path_schema, table_name, logger=logger)
        sql_operations.create_table(table_dw, schema)

    sql_operations.connexion.close()
